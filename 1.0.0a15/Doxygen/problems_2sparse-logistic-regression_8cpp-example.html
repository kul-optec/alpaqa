<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>alpaqa: problems/sparse-logistic-regression.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {    Reals: "{\\mathrm{I\\!R}}",
    Nats: "{\\mathrm{I\\!N}}",
    Cplx: "{\\mathbb{C}}",
    R: "{\\Reals}",
    N: "{\\Nats}",
    C: "{\\Cplx}",
    Rn: "{\\Reals^n}",
    Rm: "{\\Reals^m}",
    gph: "{\\operatorname{\\mathbf{gph}}}",
    zer: "{\\operatorname{\\mathbf{zer}}}",
    fix: "{\\operatorname{\\mathbf{fix}}}",
    minimize: "{\\operatorname*{\\mathbf{minimize}}}",
    st: "{\\operatorname*{\\mathbf{s.\\!t.}}}",
    argmin: "{\\operatorname*{\\mathbf{arg\\,min}}}",
    argmax: "{\\operatorname*{\\mathbf{arg\\,max}}}",
    subjto: "{\\operatorname*{\\mathbf{subject\\;to}}}",
    prox: "{\\operatorname{\\mathbf{prox}}}",
    Hilb: "{\\mathcal{H}}",
    proj: ["{\\operatorname{\\mathbf{\\Pi}_\\mathnormal{#1}}}",1],
    dist: "{\\operatorname{\\mathbf{dist}}}",
    Id: "{\\mathrm{Id}}",
    I: "{\\mathrm{I}}",
    one: "{\\mathbf{1}}",
    defeq: "{\\triangleq}",
    inprod: ["{\\left\\langle {#1} \\,\\middle|\\, {#2} \\right\\rangle}",2],
    norm: ["{\\left\\| {#1} \\vphantom{X} \\right\\|}",1],
    normsq: ["{\\norm{#1}^2}",1],
    defset: ["{\\left\\{ {#1} \\;\\middle|\\; {#2} \\right\\}}",2],
    tp: ["{#1^\\top}",1],
    ttp: ["{#1^{\\!\\top\\!}}",1],
    herm: ["{#1^\\mathrm{H}}",1],
    invherm: ["{#1^{-\\mathrm{H}}}",1],
    inv: ["{#1^{-1}}",1],
    pinv: ["{#1^\\dagger}",1],
    lconj: "{\\overline}",
    sconj: ["{#1^*}",1],
    iddots: "{\\mathinner{\\kern1mu\\raise1pt{.}\\kern2mu\\raise4pt{.}\\kern2mu\\raise7pt{\\Rule{0pt}{7pt}{0pt}.}\\kern1mu}}",
    imagfun: ["{\\left(#1\\right)\\left(#2\\right)}",2],
    Lagr: "{\\mathcal{L}}",
    jac: "{\\mathrm{J}}",
    dft: "{\\operatorname{\\mathbf{dft}}}",
    cbrt: ["{\\sqrt[3]{#1}}",1],
    sgn: "{\\operatorname{\\mathbf{sgn}}}",
    setmap: "{\\rightrightarrows}",
    lammin: "{\\lambda_\\text{min}}",
    lammax: "{\\lambda_\\text{max}}",
    Sc: "{\\mathcal{S}}",
    Scstar: "{\\mathcal{S}^*}",
    diag: "{\\operatorname{\\mathbf{diag}}}",
    blkdiag: "{\\operatorname{\\mathbf{blkdiag}}}",
    posdef: "{\\succ}",
    possdef: "{\\succeq}",
    half: "{\\tfrac{1}{2}}",
    hhbar: "{\\hbar}",
    barxuk: "{\\bar x^k\\!, \\bar u^k}",
    },
    packages: ['base','configmacros','newcommand','ams']
  }
};
window.MathJax.tex.tags = 'ams';
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">alpaqa<span id="projectnumber">&#160;<code><a href="/alpaqa/index.html">1.0.0a15</a></code></span>
   </div>
   <div id="projectbrief">Nonconvex constrained optimization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">problems/sparse-logistic-regression.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>This is an example that builds a problem in C++ that can be loaded dynamically by the alpaqa solvers.</p>
<p>This is an example that builds a problem in C++ that can be loaded dynamically by the alpaqa solvers.The problem is a simple sparse logistic regression task.</p>
<p>All problem functions are implemented as member functions of the <code>Problem</code> class. This class also contains a member <code>funcs</code> of type <a class="el" href="structalpaqa__problem__functions__t.html">alpaqa_problem_functions_t</a>, which is used to expose those functions to the solvers. The provided problem functions are added to this <code>funcs</code> struct by the <code>Problem</code> constructor. To adapt the member functions to ordinary function pointers, the <a class="el" href="namespacealpaqa.html#ac89f5922c0df808ae24f23e0f2561191">alpaqa::member_caller</a> function is used. <br  />
 The constructor also loads the actual classification data from the given CSV file.</p>
<p>The main entry point is the <code>register_alpaqa_problem</code> function at the bottom. It is the only function that is exported from the shared module, and it is called by the <a class="el" href="classalpaqa_1_1dl_1_1DLProblem.html">alpaqa::dl::DLProblem</a> class when loading the problem for the solvers. <br  />
 Its purpose is to create a problem instance, and return a pointer to it, as well as additional information such as how to clean up the created problem, and a pointer to the provided functions (the <code>funcs</code> member from earlier).</p>
<p>The entry point also accepts a pointer to type-erased user data. You can use this to pass any additional data to the problem constructor, such as problem parameters. When using the <code>alpaqa-driver</code> program, the type of this user data is always <code>std::any *</code>. Inside of the <code>std::any</code>, there is a span of string views containing the problem-specific command line options. <br  />
 In this example, the <code>datafile</code> and <code>λ_factor</code> options are supported. The former selects the CSV file to load the data from, the latter controls the regularization parameter.</p>
<p>To run this example, first build the <code>alpaqa-driver</code> program, and then build the <code>sparse-logistic-regression</code> module. The regression data is generated by executing the <code>generate-data.py</code> script (requires the <code>scikit-learn</code> package), it outputs a CSV file that is loaded in the <code>load_data</code> function defined below. <br  />
 Finally, execute the driver with the appropriate arguments as shown below. </p><div class="fragment"><div class="line">export CFLAGS=&quot;-march=native&quot;; export CXXFLAGS=&quot;-march=native&quot;; export FFLAGS=&quot;-march=native&quot;</div>
<div class="line">cmake -Bbuild -S. -G &quot;Ninja Multi-Config&quot; -D CMAKE_POSITION_INDEPENDENT_CODE=On</div>
<div class="line">cmake --build build -j --config RelWithDebInfo -t driver</div>
<div class="line">cmake --build build -j --config RelWithDebInfo -t sparse-logistic-regression</div>
<div class="line">python3 -m pip install -U scikit-learn</div>
<div class="line">python3 examples/problems/generate-data.py</div>
<div class="line">./build/src/RelWithDebInfo/alpaqa-driver \</div>
<div class="line">    build/examples/problems/RelWithDebInfo/sparse-logistic-regression.so \</div>
<div class="line">    problem.datafile=breast_cancer.csv \</div>
<div class="line">    problem.λ_factor=1e-5 \</div>
<div class="line">    sol=output/ \</div>
<div class="line">    method=panoc.lbfgs</div>
</div><!-- fragment --><p> The solution is written to a CSV file in the <code>output</code> directory.</p>
<p>Run <code>./build/src/RelWithDebInfo/alpaqa-driver</code> without arguments for usage and argument information.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sparse-logistic-regression-export.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="config_8hpp.html">alpaqa/config/config.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dl-problem_8h.html">alpaqa/dl/dl-problem.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="params_8hpp.html">alpaqa/params/params.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="csv_8hpp.html">alpaqa/util/io/csv.hpp</a>&gt;</span></div>
<div class="line"><a id="a0" name="a0"></a><a class="code hl_define" href="config_8hpp.html#a3c06cc0dbec2055c76ab3d5fcc91736c">USING_ALPAQA_CONFIG</a>(<a id="_a1" name="_a1"></a><a class="code hl_struct" href="structalpaqa_1_1EigenConfigd.html">alpaqa::DefaultConfig</a>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;any&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;filesystem&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;span&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string_view&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>fs = std::filesystem;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Problem {</div>
<div class="line">    <a id="_a2" name="_a2"></a><a class="code hl_struct" href="structalpaqa__problem__functions__t.html">alpaqa_problem_functions_t</a> funcs{};</div>
<div class="line">    length_t n;         <span class="comment">///&lt; Number of features</span></div>
<div class="line">    length_t m;         <span class="comment">///&lt; Number of data points</span></div>
<div class="line">    real_t λ;           <span class="comment">///&lt; Regularization factor</span></div>
<div class="line">    real_t μ;           <span class="comment">///&lt; Scaling factor</span></div>
<div class="line">    mat A;              <span class="comment">///&lt; Data matrix (m×n)</span></div>
<div class="line">    vec b;              <span class="comment">///&lt; Binary labels (m)</span></div>
<div class="line">    vec Aᵀb;            <span class="comment">///&lt; Work vector (n)</span></div>
<div class="line">    <span class="keyword">mutable</span> vec Ax;     <span class="comment">///&lt; Work vector (m)</span></div>
<div class="line">    fs::path data_file; <span class="comment">///&lt; File we loaded the data from</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// φ(x) = ∑ ln(1 + exp(-b x))</span></div>
<div class="line"><span class="comment"></span>    real_t logistic_loss(crvec x)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keyword">auto</span> &amp;&amp;xa = x.array();</div>
<div class="line">        <span class="keyword">auto</span> &amp;&amp;ba = b.array();</div>
<div class="line">        <span class="keywordflow">return</span> ((-ba * xa).exp() + 1).log().sum();</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// -dφ(x)/dx = b / (exp(b x) + 1)</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> neg_deriv_logistic_loss(crvec x, rvec g)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keyword">auto</span> &amp;&amp;xa = x.array();</div>
<div class="line">        <span class="keyword">auto</span> &amp;&amp;ba = b.array();</div>
<div class="line">        g         = ba / ((ba * xa).exp() + 1);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// σ₂(x) = b exp(b x) / (exp(b x) + 1)²</span></div>
<div class="line"><span class="comment">    /// @note Assumes that b is a binary vector (i.e. b² = b).</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> sigmoid2(crvec x, rvec g)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keyword">auto</span> &amp;&amp;xa = x.array();</div>
<div class="line">        <span class="keyword">auto</span> &amp;&amp;ba = b.array();</div>
<div class="line">        g         = (ba * xa).exp();</div>
<div class="line">        g         = ba * g.array() / ((g.array() + 1) * (g.array() + 1));</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Objective function.</span></div>
<div class="line"><span class="comment"></span>    <a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a> eval_f(<span class="keyword">const</span> real_t *x_)<span class="keyword"> const </span>{</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">cmvec</a> x{x_, n};</div>
<div class="line">        Ax.noalias() = A * x;</div>
<div class="line">        <span class="keywordflow">return</span> μ * logistic_loss(Ax);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Gradient of objective.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_grad_f(<span class="keyword">const</span> real_t *x_, real_t *g_)<span class="keyword"> const </span>{</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">cmvec</a> x{x_, n};</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a0646c35d2166719ff44cd6f8e9bf4770">mvec</a> g{g_, n};</div>
<div class="line">        Ax.noalias() = A * x;</div>
<div class="line">        <span class="comment">// ∇(f∘A)(x) = Aᵀ∇f(Ax)</span></div>
<div class="line">        neg_deriv_logistic_loss(Ax, Ax);         <span class="comment">// Ax ← -∇f(Ax)</span></div>
<div class="line">        g.noalias() = -μ * (A.transpose() * Ax); <span class="comment">// g ← μAᵀ∇f(Ax)</span></div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Hessian-vector product of objective.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_hess_f_prod(<span class="keyword">const</span> real_t *x_, <span class="keyword">const</span> real_t *v_,</div>
<div class="line">                          real_t *Hv_)<span class="keyword"> const </span>{</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">cmvec</a> x{x_, n};</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">cmvec</a> v{v_, n};</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a0646c35d2166719ff44cd6f8e9bf4770">mvec</a> Hv{Hv_, n};</div>
<div class="line">        Ax.noalias() = A * x;</div>
<div class="line">        sigmoid2(Ax, Ax);</div>
<div class="line">        Ax.noalias() = Ax.asDiagonal() * (A * v);</div>
<div class="line">        Hv.noalias() = μ * (A.transpose() * Ax);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Hessian of objective.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_hess_f(<span class="keyword">const</span> real_t *x_, real_t *H_)<span class="keyword"> const </span>{</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">cmvec</a> x{x_, n};</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a9bb6433204e7c61ca8a12916b29a8f8d">mmat</a> H{H_, n, n};</div>
<div class="line">        Ax.noalias() = A * x;</div>
<div class="line">        sigmoid2(Ax, Ax);</div>
<div class="line">        H.noalias() = A.transpose() * (μ * Ax.asDiagonal()) * A;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Hessian-vector product of Lagrangian.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_hess_L_prod(<span class="keyword">const</span> real_t *x, [[maybe_unused]] <span class="keyword">const</span> real_t *y,</div>
<div class="line">                          real_t scale, <span class="keyword">const</span> real_t *v, real_t *Hv)<span class="keyword"> const </span>{</div>
<div class="line">        eval_hess_f_prod(x, v, Hv);</div>
<div class="line">        <span class="keywordflow">if</span> (scale != 1)</div>
<div class="line">            <a class="code hl_typedef" href="namespacealpaqa.html#a0646c35d2166719ff44cd6f8e9bf4770">mvec</a>{Hv, n} *= scale;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Hessian-vector product of augmented Lagrangian.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_hess_ψ_prod(<span class="keyword">const</span> real_t *x, <span class="keyword">const</span> real_t *y,</div>
<div class="line">                          [[maybe_unused]] <span class="keyword">const</span> real_t *Σ, real_t scale,</div>
<div class="line">                          [[maybe_unused]] <span class="keyword">const</span> real_t *zl,</div>
<div class="line">                          [[maybe_unused]] <span class="keyword">const</span> real_t *zu, <span class="keyword">const</span> real_t *v,</div>
<div class="line">                          real_t *Hv)<span class="keyword"> const </span>{</div>
<div class="line">        eval_hess_L_prod(x, y, scale, v, Hv);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Hessian of Lagrangian.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_hess_L(<span class="keyword">const</span> real_t *x, [[maybe_unused]] <span class="keyword">const</span> real_t *y,</div>
<div class="line">                     real_t scale, real_t *H)<span class="keyword"> const </span>{</div>
<div class="line">        eval_hess_f(x, H);</div>
<div class="line">        <span class="keywordflow">if</span> (scale != 1)</div>
<div class="line">            <a class="code hl_typedef" href="namespacealpaqa.html#a9bb6433204e7c61ca8a12916b29a8f8d">mmat</a>{H, n, n} *= scale;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Hessian of augmented Lagrangian.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_hess_ψ(<span class="keyword">const</span> real_t *x, <span class="keyword">const</span> real_t *y,</div>
<div class="line">                     [[maybe_unused]] <span class="keyword">const</span> real_t *Σ, real_t scale,</div>
<div class="line">                     [[maybe_unused]] <span class="keyword">const</span> real_t *zl,</div>
<div class="line">                     [[maybe_unused]] <span class="keyword">const</span> real_t *zu, real_t *H)<span class="keyword"> const </span>{</div>
<div class="line">        eval_hess_L(x, y, scale, H);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Both the objective and its gradient.</span></div>
<div class="line"><span class="comment"></span>    <a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a> eval_f_grad_f(<span class="keyword">const</span> real_t *x_, real_t *g_)<span class="keyword"> const </span>{</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">cmvec</a> x{x_, n};</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a0646c35d2166719ff44cd6f8e9bf4770">mvec</a> g{g_, n};</div>
<div class="line">        Ax.noalias() = A * x;</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a> f     = μ * logistic_loss(Ax);</div>
<div class="line">        <span class="comment">// ∇(f∘A)(x) = Aᵀ∇f(Ax)</span></div>
<div class="line">        neg_deriv_logistic_loss(Ax, Ax);         <span class="comment">// Ax ← -∇f(Ax)</span></div>
<div class="line">        g.noalias() = -μ * (A.transpose() * Ax); <span class="comment">// g ← μAᵀ∇f(Ax)</span></div>
<div class="line">        <span class="keywordflow">return</span> f;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Constraints function (unconstrained).</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_g(<span class="keyword">const</span> real_t *, real_t *)<span class="keyword"> const </span>{}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Gradient-vector product of constraints.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_grad_g_prod(<span class="keyword">const</span> real_t *, <span class="keyword">const</span> real_t *, real_t *gr_)<span class="keyword"> const </span>{</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a0646c35d2166719ff44cd6f8e9bf4770">mvec</a>{gr_, n}.setZero();</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Jacobian of constraints.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> eval_jac_g(<span class="keyword">const</span> real_t *, real_t *)<span class="keyword"> const </span>{}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// ℓ₁-regularization term.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> initialize_l1_reg(real_t *lambda, length_t *size)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (!lambda) {</div>
<div class="line">            *size = 1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            assert(*size == 1);</div>
<div class="line">            *lambda = λ;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Loads classification data from a CSV file.</span></div>
<div class="line"><span class="comment">    /// The first row contains the number of data points and the number of</span></div>
<div class="line"><span class="comment">    /// features, separated by a space.</span></div>
<div class="line"><span class="comment">    /// The second row contains the binary labels for all data points.</span></div>
<div class="line"><span class="comment">    /// Every following row contains the values of one feature for all data</span></div>
<div class="line"><span class="comment">    /// points.</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> load_data() {</div>
<div class="line">        std::ifstream csv_file{data_file};</div>
<div class="line">        <span class="keywordflow">if</span> (!csv_file)</div>
<div class="line">            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Unable to open file &#39;&quot;</span> +</div>
<div class="line">                                     data_file.string() + <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">        <span class="comment">// Load dimensions (#data points, #features)</span></div>
<div class="line">        csv_file &gt;&gt; m &gt;&gt; n;</div>
<div class="line">        csv_file.ignore(1, <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (!csv_file)</div>
<div class="line">            <span class="keywordflow">throw</span> std::runtime_error(</div>
<div class="line">                <span class="stringliteral">&quot;Unable to read dimensions from data file&quot;</span>);</div>
<div class="line">        b.resize(m);</div>
<div class="line">        A.resize(m, n);</div>
<div class="line">        Aᵀb.resize(n);</div>
<div class="line">        Ax.resize(m);</div>
<div class="line">        <span class="comment">// Read the target labels</span></div>
<div class="line">        <a id="a3" name="a3"></a><a class="code hl_function" href="namespacealpaqa_1_1csv.html#a9e26a8f48527f00e7b73974c398c008a">alpaqa::csv::read_row</a>(csv_file, b);</div>
<div class="line">        <span class="comment">// Read the data</span></div>
<div class="line">        <span class="keywordflow">for</span> (length_t i = 0; i &lt; n; ++i)</div>
<div class="line">            <a class="code hl_function" href="namespacealpaqa_1_1csv.html#a9e26a8f48527f00e7b73974c398c008a">alpaqa::csv::read_row</a>(csv_file, A.col(i));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::string get_name()<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;sparse logistic regression (\&quot;&quot;</span> + data_file.string() + <span class="stringliteral">&quot;\&quot;)&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Constructor loads CSV data file and exposes the problem functions by</span></div>
<div class="line"><span class="comment">    /// initializing the @c funcs member.</span></div>
<div class="line"><span class="comment"></span>    Problem(fs::path csv_filename, real_t λ_factor)</div>
<div class="line">        : data_file(std::move(csv_filename)) {</div>
<div class="line">        load_data();</div>
<div class="line">        Aᵀb.noalias() = A.transpose() * b;</div>
<div class="line">        <a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a> λ_max = Aᵀb.lpNorm&lt;Eigen::Infinity&gt;() / <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a><span class="keyword">&gt;</span>(m);</div>
<div class="line">        λ            = λ_factor * λ_max;</div>
<div class="line">        μ            = 1. / <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a><span class="keyword">&gt;</span>(m);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">using </span>P = Problem;</div>
<div class="line">        <span class="keyword">using </span><a id="a4" name="a4"></a><a class="code hl_function" href="namespacealpaqa.html#ac89f5922c0df808ae24f23e0f2561191">alpaqa::member_caller</a>;</div>
<div class="line">        funcs.n                = n;</div>
<div class="line">        funcs.m                = 0;</div>
<div class="line">        funcs.eval_f           = member_caller&lt;&amp;P::eval_f&gt;();</div>
<div class="line">        funcs.eval_grad_f      = member_caller&lt;&amp;P::eval_grad_f&gt;();</div>
<div class="line">        funcs.eval_f_grad_f    = member_caller&lt;&amp;P::eval_f_grad_f&gt;();</div>
<div class="line">        funcs.eval_g           = member_caller&lt;&amp;P::eval_g&gt;();</div>
<div class="line">        funcs.eval_grad_g_prod = member_caller&lt;&amp;P::eval_grad_g_prod&gt;();</div>
<div class="line">        funcs.eval_jac_g       = member_caller&lt;&amp;P::eval_jac_g&gt;();</div>
<div class="line">        funcs.eval_hess_L_prod = member_caller&lt;&amp;P::eval_hess_L_prod&gt;();</div>
<div class="line">        funcs.eval_hess_ψ_prod = member_caller&lt;&amp;P::eval_hess_ψ_prod&gt;();</div>
<div class="line">        funcs.eval_hess_L      = member_caller&lt;&amp;P::eval_hess_L&gt;();</div>
<div class="line">        funcs.eval_hess_ψ      = member_caller&lt;&amp;P::eval_hess_ψ&gt;();</div>
<div class="line">        <span class="keywordflow">if</span> (λ &gt; 0)</div>
<div class="line">            funcs.initialize_l1_reg = member_caller&lt;&amp;P::initialize_l1_reg&gt;();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Main entry point of this file, it is called by the</span></div>
<div class="line"><span class="comment">/// @ref alpaqa::dl::DLProblem class.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> SPARSE_LOGISTIC_REGRESSION_EXPORT <a id="_a5" name="_a5"></a><a class="code hl_struct" href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a></div>
<div class="line">register_alpaqa_problem(<span class="keywordtype">void</span> *user_data_v) <span class="keyword">noexcept</span> <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Check and convert user arguments</span></div>
<div class="line">    <span class="keywordflow">if</span> (!user_data_v)</div>
<div class="line">        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Missing user data&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;user_data = *<span class="keyword">reinterpret_cast&lt;</span>std::any *<span class="keyword">&gt;</span>(user_data_v);</div>
<div class="line">    <span class="keyword">using </span>param_t         = std::span&lt;std::string_view&gt;;</div>
<div class="line">    <span class="keyword">auto</span> opts             = std::any_cast&lt;param_t&gt;(user_data);</div>
<div class="line">    std::vector&lt;unsigned&gt; used(opts.size());</div>
<div class="line">    <span class="comment">// CSV file to load dataset from</span></div>
<div class="line">    std::string_view datafilename;</div>
<div class="line">    <a id="a6" name="a6"></a><a class="code hl_function" href="namespacealpaqa_1_1params.html#abadc98653193fbd05b658d62b34f75e7">alpaqa::params::set_params</a>(datafilename, <span class="stringliteral">&quot;datafile&quot;</span>, opts, used);</div>
<div class="line">    <span class="keywordflow">if</span> (datafilename.empty())</div>
<div class="line">        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Missing option problem.datafile&quot;</span>);</div>
<div class="line">    <span class="comment">// Regularization factor</span></div>
<div class="line">    <a class="code hl_typedef" href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">real_t</a> λ_factor = 0.1;</div>
<div class="line">    <a class="code hl_function" href="namespacealpaqa_1_1params.html#abadc98653193fbd05b658d62b34f75e7">alpaqa::params::set_params</a>(λ_factor, <span class="stringliteral">&quot;λ_factor&quot;</span>, opts, used);</div>
<div class="line">    <span class="comment">// Check any unused options</span></div>
<div class="line">    <span class="keyword">auto</span> unused_opt = std::find(used.begin(), used.end(), 0);</div>
<div class="line">    <span class="keyword">auto</span> unused_idx = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(unused_opt - used.begin());</div>
<div class="line">    <span class="keywordflow">if</span> (unused_opt != used.end())</div>
<div class="line">        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Unused problem option: &quot;</span> +</div>
<div class="line">                                    std::string(opts[unused_idx]));</div>
<div class="line">    <span class="comment">// Build and expose problem</span></div>
<div class="line">    <span class="keyword">auto</span> problem = std::make_unique&lt;Problem&gt;(datafilename, λ_factor);</div>
<div class="line">    <a class="code hl_struct" href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a> result;</div>
<div class="line">    <a id="a7" name="a7"></a><a class="code hl_function" href="namespacealpaqa.html#aaa3d18067ff2a8792845870baeb6c53a">alpaqa::register_member_function</a>(result, <span class="stringliteral">&quot;get_name&quot;</span>, &amp;Problem::get_name);</div>
<div class="line">    result.<a id="a8" name="a8"></a><a class="code hl_variable" href="structalpaqa__problem__register__t.html#ae4bc438069960eba10e7d965867c1727">functions</a> = &amp;problem-&gt;funcs;</div>
<div class="line">    result.<a id="a9" name="a9"></a><a class="code hl_variable" href="structalpaqa__problem__register__t.html#ae1b90392cd257d16fd66a85bac1b08cd">instance</a>  = problem.release();</div>
<div class="line">    result.<a id="a10" name="a10"></a><a class="code hl_variable" href="structalpaqa__problem__register__t.html#a1eaa491e8cc81620bcf4875d22d22b2b">cleanup</a>   = [](<span class="keywordtype">void</span> *instance) {</div>
<div class="line">        <span class="keyword">delete</span> <span class="keyword">static_cast&lt;</span>Problem *<span class="keyword">&gt;</span>(instance);</div>
<div class="line">    };</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">} <span class="keywordflow">catch</span> (...) {</div>
<div class="line">    <span class="keywordflow">return</span> {.<a id="a11" name="a11"></a><a class="code hl_variable" href="structalpaqa__problem__register__t.html#a5e58a53fd5f925dc254d8be0b70556f3">exception</a> = <span class="keyword">new</span> <a id="_a12" name="_a12"></a><a class="code hl_struct" href="dl-problem_8h.html#structalpaqa__exception__ptr__s">alpaqa_exception_ptr_t</a>{std::current_exception()}};</div>
<div class="line">}</div>
<div class="ttc" id="aconfig_8hpp_html"><div class="ttname"><a href="config_8hpp.html">config.hpp</a></div></div>
<div class="ttc" id="aconfig_8hpp_html_a3c06cc0dbec2055c76ab3d5fcc91736c"><div class="ttname"><a href="config_8hpp.html#a3c06cc0dbec2055c76ab3d5fcc91736c">USING_ALPAQA_CONFIG</a></div><div class="ttdeci">#define USING_ALPAQA_CONFIG(Conf)</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00056">config.hpp:56</a></div></div>
<div class="ttc" id="acsv_8hpp_html"><div class="ttname"><a href="csv_8hpp.html">csv.hpp</a></div></div>
<div class="ttc" id="adl-problem_8h_html"><div class="ttname"><a href="dl-problem_8h.html">dl-problem.h</a></div></div>
<div class="ttc" id="adl-problem_8h_html_structalpaqa__exception__ptr__s"><div class="ttname"><a href="dl-problem_8h.html#structalpaqa__exception__ptr__s">alpaqa_exception_ptr_s</a></div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00595">dl-problem.h:595</a></div></div>
<div class="ttc" id="anamespacealpaqa_1_1csv_html_a9e26a8f48527f00e7b73974c398c008a"><div class="ttname"><a href="namespacealpaqa_1_1csv.html#a9e26a8f48527f00e7b73974c398c008a">alpaqa::csv::read_row</a></div><div class="ttdeci">void read_row(std::istream &amp;is, Eigen::Ref&lt; Eigen::VectorX&lt; Eigen::Index &gt; &gt; v, char sep)</div><div class="ttdef"><b>Definition</b> <a href="csv_8hpp_source.html#l00037">csv.hpp:37</a></div></div>
<div class="ttc" id="anamespacealpaqa_1_1params_html_abadc98653193fbd05b658d62b34f75e7"><div class="ttname"><a href="namespacealpaqa_1_1params.html#abadc98653193fbd05b658d62b34f75e7">alpaqa::params::set_params</a></div><div class="ttdeci">void set_params(T &amp;t, std::string_view prefix, std::span&lt; const std::string_view &gt; options, std::optional&lt; std::span&lt; unsigned &gt; &gt; used=std::nullopt)</div><div class="ttdoc">Overwrites t based on the options that start with prefix.</div><div class="ttdef"><b>Definition</b> <a href="params_8hpp_source.html#l00049">params.hpp:49</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_a0646c35d2166719ff44cd6f8e9bf4770"><div class="ttname"><a href="namespacealpaqa.html#a0646c35d2166719ff44cd6f8e9bf4770">alpaqa::mvec</a></div><div class="ttdeci">typename Conf::mvec mvec</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00067">config.hpp:67</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_a7a33e291d31dd58415d260f72cdf791e"><div class="ttname"><a href="namespacealpaqa.html#a7a33e291d31dd58415d260f72cdf791e">alpaqa::real_t</a></div><div class="ttdeci">typename Conf::real_t real_t</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00065">config.hpp:65</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_a9bb6433204e7c61ca8a12916b29a8f8d"><div class="ttname"><a href="namespacealpaqa.html#a9bb6433204e7c61ca8a12916b29a8f8d">alpaqa::mmat</a></div><div class="ttdeci">typename Conf::mmat mmat</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00072">config.hpp:72</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_aaa3d18067ff2a8792845870baeb6c53a"><div class="ttname"><a href="namespacealpaqa.html#aaa3d18067ff2a8792845870baeb6c53a">alpaqa::register_member_function</a></div><div class="ttdeci">void register_member_function(Result &amp;result, std::string name, Ret(T::*member)(Args...))</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00634">dl-problem.h:634</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_aacf9174dd35e7630a94a7d0b629a73ea"><div class="ttname"><a href="namespacealpaqa.html#aacf9174dd35e7630a94a7d0b629a73ea">alpaqa::cmvec</a></div><div class="ttdeci">typename Conf::cmvec cmvec</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00068">config.hpp:68</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_ac89f5922c0df808ae24f23e0f2561191"><div class="ttname"><a href="namespacealpaqa.html#ac89f5922c0df808ae24f23e0f2561191">alpaqa::member_caller</a></div><div class="ttdeci">static auto member_caller()</div><div class="ttdoc">Wrap the given member function or variable into a (possibly generic) lambda function that accepts the...</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00704">dl-problem.h:704</a></div></div>
<div class="ttc" id="aparams_8hpp_html"><div class="ttname"><a href="params_8hpp.html">params.hpp</a></div></div>
<div class="ttc" id="astructalpaqa_1_1EigenConfigd_html"><div class="ttname"><a href="structalpaqa_1_1EigenConfigd.html">alpaqa::EigenConfigd</a></div><div class="ttdoc">Double-precision double configuration.</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00135">config.hpp:135</a></div></div>
<div class="ttc" id="astructalpaqa__problem__functions__t_html"><div class="ttname"><a href="structalpaqa__problem__functions__t.html">alpaqa_problem_functions_t</a></div><div class="ttdoc">C API providing function pointers to problem functions.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00157">dl-problem.h:157</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html"><div class="ttname"><a href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a></div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00363">dl-problem.h:363</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_a1eaa491e8cc81620bcf4875d22d22b2b"><div class="ttname"><a href="structalpaqa__problem__register__t.html#a1eaa491e8cc81620bcf4875d22d22b2b">alpaqa_problem_register_t::cleanup</a></div><div class="ttdeci">void(* cleanup)(void *)</div><div class="ttdoc">Pointer to the function to clean up instance.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00372">dl-problem.h:372</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_a5e58a53fd5f925dc254d8be0b70556f3"><div class="ttname"><a href="structalpaqa__problem__register__t.html#a5e58a53fd5f925dc254d8be0b70556f3">alpaqa_problem_register_t::exception</a></div><div class="ttdeci">alpaqa_exception_ptr_t * exception</div><div class="ttdoc">Pointer to an exception that ocurred during problem creation.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00378">dl-problem.h:378</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_ae1b90392cd257d16fd66a85bac1b08cd"><div class="ttname"><a href="structalpaqa__problem__register__t.html#ae1b90392cd257d16fd66a85bac1b08cd">alpaqa_problem_register_t::instance</a></div><div class="ttdeci">void * instance</div><div class="ttdoc">Owning pointer.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00368">dl-problem.h:368</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_ae4bc438069960eba10e7d965867c1727"><div class="ttname"><a href="structalpaqa__problem__register__t.html#ae4bc438069960eba10e7d965867c1727">alpaqa_problem_register_t::functions</a></div><div class="ttdeci">alpaqa_problem_functions_t * functions</div><div class="ttdoc">Non-owning pointer, lifetime at least as long as instance.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00370">dl-problem.h:370</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 22 2023 for alpaqa by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
