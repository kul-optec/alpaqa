<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>alpaqa: Problem formulations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {    Reals: "{\\mathrm{I\\!R}}",
    Nats: "{\\mathrm{I\\!N}}",
    Cplx: "{\\mathbb{C}}",
    R: "{\\Reals}",
    N: "{\\Nats}",
    C: "{\\Cplx}",
    Rn: "{\\Reals^n}",
    Rm: "{\\Reals^m}",
    gph: "{\\operatorname{\\mathbf{gph}}}",
    zer: "{\\operatorname{\\mathbf{zer}}}",
    fix: "{\\operatorname{\\mathbf{fix}}}",
    minimize: "{\\operatorname*{\\mathbf{minimize}}}",
    st: "{\\operatorname*{\\mathbf{s.\\!t.}}}",
    argmin: "{\\operatorname*{\\mathbf{arg\\,min}}}",
    argmax: "{\\operatorname*{\\mathbf{arg\\,max}}}",
    subjto: "{\\operatorname*{\\mathbf{subject\\;to}}}",
    prox: "{\\operatorname{\\mathbf{prox}}}",
    Hilb: "{\\mathcal{H}}",
    proj: ["{\\operatorname{\\mathbf{\\Pi}_\\mathnormal{#1}}}",1],
    dist: "{\\operatorname{\\mathbf{dist}}}",
    Id: "{\\mathrm{Id}}",
    I: "{\\mathrm{I}}",
    one: "{\\mathbf{1}}",
    defeq: "{\\triangleq}",
    inprod: ["{\\left\\langle {#1} \\,\\middle|\\, {#2} \\right\\rangle}",2],
    norm: ["{\\left\\| {#1} \\vphantom{X} \\right\\|}",1],
    normsq: ["{\\norm{#1}^2}",1],
    defset: ["{\\left\\{ {#1} \\;\\middle|\\; {#2} \\right\\}}",2],
    tp: ["{#1^\\top}",1],
    ttp: ["{#1^{\\!\\top\\!}}",1],
    herm: ["{#1^\\mathrm{H}}",1],
    invherm: ["{#1^{-\\mathrm{H}}}",1],
    inv: ["{#1^{-1}}",1],
    pinv: ["{#1^\\dagger}",1],
    lconj: "{\\overline}",
    sconj: ["{#1^*}",1],
    iddots: "{\\mathinner{\\kern1mu\\raise1pt{.}\\kern2mu\\raise4pt{.}\\kern2mu\\raise7pt{\\Rule{0pt}{7pt}{0pt}.}\\kern1mu}}",
    imagfun: ["{\\left(#1\\right)\\left(#2\\right)}",2],
    Lagr: "{\\mathcal{L}}",
    jac: "{\\mathrm{J}}",
    dft: "{\\operatorname{\\mathbf{dft}}}",
    cbrt: ["{\\sqrt[3]{#1}}",1],
    sgn: "{\\operatorname{\\mathbf{sgn}}}",
    setmap: "{\\rightrightarrows}",
    lammin: "{\\lambda_\\text{min}}",
    lammax: "{\\lambda_\\text{max}}",
    Sc: "{\\mathcal{S}}",
    Scstar: "{\\mathcal{S}^*}",
    diag: "{\\operatorname{\\mathbf{diag}}}",
    blkdiag: "{\\operatorname{\\mathbf{blkdiag}}}",
    posdef: "{\\succ}",
    possdef: "{\\succeq}",
    half: "{\\tfrac{1}{2}}",
    hhbar: "{\\hbar}",
    barxuk: "{\\bar x^k\\!, \\bar u^k}",
    },
    packages: ['base','configmacros','newcommand','ams']
  }
};
window.MathJax.tex.tags = 'ams';
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">alpaqa<span id="projectnumber">&#160;<code><a href="/alpaqa/index.html">1.0.0a17</a></code></span>
   </div>
   <div id="projectbrief">Nonconvex constrained optimization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Problem formulations</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#problem-formulations-general">General NLP formulation</a></li>
<li class="level1"><a href="#problem-api">Problem API</a><ul><li class="level2"><a href="#base-classes-for-common-use-cases">Base classes for common use cases</a></li>
<li class="level2"><a href="#second-order-derivatives">Second-order derivatives</a></li>
<li class="level2"><a href="#specialized-combined-evaluations">Specialized combined evaluations</a></li>
<li class="level2"><a href="#proximal-operators">Proximal operators</a></li>
</ul>
</li>
<li class="level1"><a href="#dynamically-loading-problems">Dynamically loading problems</a></li>
<li class="level1"><a href="#existing-problem-adapters">Existing problem adapters</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="problem-formulations-general"></a>
General NLP formulation</h1>
<p>Most alpaqa solvers deal with problems in the following form:</p>
<p class="formulaDsp">
\[
\begin{equation}\tag{P}\label{eq:problem_main}
    \begin{aligned}
        &amp; \underset{x}{\text{minimize}}
        &amp; &amp; f(x) &amp;&amp;&amp;&amp; f : \Rn \rightarrow \R \\
        &amp; \text{subject to}
        &amp; &amp; \underline{x} \le x \le \overline{x} \\
        &amp;&amp;&amp; \underline{z} \le g(x) \le \overline{z} &amp;&amp;&amp;&amp; g : \Rn \rightarrow \Rm
    \end{aligned}
\end{equation}
\]
</p>
<p>\( f \) is called the cost or objective function, and \( g \) is the constraints function.</p>
<p>The solver needs to be able to evaluate the following required functions and derivatives:</p><ul>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ac9fcb632c5d0395e2c36e39277efd1b0">eval_f</a> \( : \Rn \to \R : x \mapsto f(x) \) (objective function)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#aba98edc04bad2e0a3ad6645991cd7535">eval_grad_f</a> \( : \Rn \to \Rn : x \mapsto \nabla f(x) \) (gradient of the objective)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#acdf5c7c7f249c05d53643e1715070f45">eval_g</a> \( : \Rn \to \Rm : x \mapsto g(x) \) (constraint function)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ab3ddf22ddba40c16ab196c1371405ea0">eval_grad_g_prod</a> \( : \Rn \times \Rm \to \Rn : (x, y) \mapsto \nabla g(x)\, y \) (gradient-vector product of the constraints)</li>
</ul>
<p>Usually, <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">automatic differentiation</a> (AD) is used to evaluate the gradients and gradient-vector products. Many AD software packages are available, see e.g. <a href="https://autodiff.org/">https://autodiff.org/</a> for an overview.</p>
<p>Additionally, the solver needs to be able to project onto the rectangular sets  </p><p class="formulaDsp">
\[
\begin{equation}
    \begin{aligned}
        C &amp;\;\defeq\; \defset{x \in \Rn}{\underline{x} \le x \le \overline{x}}, \\
        D &amp;\;\defeq\; \defset{z \in \Rm}{\underline{z} \le z \le \overline{z}}.
    \end{aligned}
\end{equation}
\]
</p>
<h1><a class="anchor" id="problem-api"></a>
Problem API</h1>
<p>The alpaqa solvers access the problem functions through the API outlined in <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">alpaqa::TypeErasedProblem</a>. <br  />
 Usually, problems are defined using C++ structs, providing the evaluations described above as public member functions. These problem structs are <a href="https://en.wikipedia.org/wiki/Structural_type_system">structurally typed</a>, which means that they only need to provide member functions with the correct names and signatures. Inheriting from a common base class is not required.</p>
<p>As an example, the following struct defines a problem that can be passed to the alpaqa solvers. Detailed descriptions of each function can be found in the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">alpaqa::TypeErasedProblem</a> documentation.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>RosenbrockProblem {</div>
<div class="line">    <a class="code hl_define" href="config_8hpp.html#a3c06cc0dbec2055c76ab3d5fcc91736c">USING_ALPAQA_CONFIG</a>(<a class="code hl_struct" href="structalpaqa_1_1EigenConfigd.html">alpaqa::DefaultConfig</a>);</div>
<div class="line">    <span class="comment">// Problem dimensions</span></div>
<div class="line">    length_t get_n() <span class="keyword">const</span>; <span class="comment">// number of unknowns</span></div>
<div class="line">    length_t get_m() <span class="keyword">const</span>; <span class="comment">// number of general constraints</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cost</span></div>
<div class="line">    real_t eval_f(crvec x) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Gradient of cost</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_grad_f(crvec x, rvec grad_fx) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Constraints</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_g(crvec x, rvec gx) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Gradient-vector product of constraints</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_grad_g_prod(crvec x, crvec y, rvec grad_gxy) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Proximal gradient step</span></div>
<div class="line">    real_t eval_prox_grad_step(real_t γ, crvec x, crvec grad, rvec x̂, rvec p) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Projecting difference onto constraint set D</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_proj_diff_g(crvec z, rvec p) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Projection of Lagrange multipliers</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_proj_multipliers(rvec y, real_t max_y) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="ttc" id="aconfig_8hpp_html_a3c06cc0dbec2055c76ab3d5fcc91736c"><div class="ttname"><a href="config_8hpp.html#a3c06cc0dbec2055c76ab3d5fcc91736c">USING_ALPAQA_CONFIG</a></div><div class="ttdeci">#define USING_ALPAQA_CONFIG(Conf)</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00077">config.hpp:77</a></div></div>
<div class="ttc" id="astructalpaqa_1_1EigenConfigd_html"><div class="ttname"><a href="structalpaqa_1_1EigenConfigd.html">alpaqa::EigenConfigd</a></div><div class="ttdoc">Double-precision double configuration.</div><div class="ttdef"><b>Definition</b> <a href="config_8hpp_source.html#l00174">config.hpp:174</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="base-classes-for-common-use-cases"></a>
Base classes for common use cases</h2>
<p>Convenience classes with default implementations of some of these functions are provided for common use cases:</p><ul>
<li><a class="el" href="classalpaqa_1_1BoxConstrProblem.html">BoxConstrProblem</a> defines the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ae9f75b521c8932199f92bfdfc8f91879">eval_proj_diff_g</a>, <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ab84164ea48e4cdae5396285423fed829">eval_proj_multipliers</a> and <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a02bf998629ca590cf5a2e183cbf43444">eval_prox_grad_step</a> functions for the specific case where \( C \) and \( D \) are rectangular boxes, as in \( \eqref{eq:problem_main} \).</li>
<li><a class="el" href="classalpaqa_1_1UnconstrProblem.html">UnconstrProblem</a> defines those same functions, and additional empty implementations of constraint-related functions to allow a more concise formulation of unconstrained problems.</li>
</ul>
<p>The user can simply inherit from these classes to inject the default implementations into their problem definition, as demonstrated in the following examples.</p><ul>
<li><a class="el" href="C_09_09_2CustomCppProblem_2main_8cpp-example.html">C++/CustomCppProblem/main.cpp</a></li>
<li><a class="el" href="C_09_09_2SimpleUnconstrProblem_2main_8cpp-example.html">C++/SimpleUnconstrProblem/main.cpp</a></li>
</ul>
<p>It is highly recommended to study the <a class="el" href="C_09_09_2CustomCppProblem_2main_8cpp-example.html">C++/CustomCppProblem/main.cpp</a> example now to see how optimization problems can be formulated in practice, before we continue with some more specialized use cases.</p>
<h2><a class="anchor" id="second-order-derivatives"></a>
Second-order derivatives</h2>
<p>Some solvers can exploit information about the Hessian of the (augmented) Lagrangian of the problem. To use these solvers, some of the following functions are required, they should be added as member functions to your problem struct.</p><ul>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a2508e5576d24f2fa233e812d6b377604">eval_jac_g</a>: Jacobian matrix of the constraints</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a28c58e7e7e62fb685653734d14c48751">get_jac_g_sparsity</a>: sparsity pattern of the Jacobian of the constraints</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a1a3532b9cb69303527a65d24e07b23b8">eval_grad_gi</a>: gradient of a specific constraint</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ab5bca0389ad783efa413bbdda072b9e9">eval_hess_L_prod</a>: Hessian-vector product of the Lagrangian</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ad7a02043161c640d10aa5ee6b8ac5b1b">eval_hess_L</a>: Hessian matrix of the Lagrangian</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a41e707318618b662995c85bdd82cf0a5">get_hess_L_sparsity</a>: sparsity pattern of the Hessian of the Lagrangian</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#afbb23530a41d88544aa22358de5d7d1f">eval_hess_ψ_prod</a>: Hessian-vector product of the Hessian of the augmented Lagrangian</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a409dbbf883d419bc5d4f0113cb42cfeb">eval_hess_ψ</a>: Hessian matrix of the augmented Lagrangian</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a37c7d4b0b4e437f4834d17243eb21ab6">get_hess_ψ_sparsity</a>: sparsity pattern of the Hessian of the augmented Lagrangian</li>
</ul>
<p>Matrices can be stored in a dense format, in <a href="https://www.eigen.tuxfamily.org/dox/group__TutorialSparse.html#TutorialSparseIntro">compressed sparse column storage</a> (CCS) format, or in sparse coordinate list format (COO). Solvers convert the input to a format that they support, so some performance could be gained by choosing the appropriate storage type, because conversions may involve sorting indices and permuting the nonzero values. See <a class="el" href="namespacealpaqa_1_1sparsity.html">alpaqa::sparsity</a> for details. For sparse symmetric Hessian matrices, only the upper-triangular part is stored. Dense matrices are always stored in full, even if they are symmetric. The matrix evaluation functions only overwrite the nonzero values, vectorized by column.</p>
<p>Some solvers do not require the full Hessian matrices, but use Hessian-vector products only, for example when using Newton-CG. These products can often be computed efficiently using automatic differentiation, at a computational cost that's not much higher than a gradient evaluation.</p>
<p>The <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">TypeErasedProblem</a> class provides functions to query which optional problem functions are available. For example, <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a3abcd94b37675bbd5f6a86e3fb85cda1">provides_eval_jac_g</a> returns true if the problem provides an implementation for <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a2508e5576d24f2fa233e812d6b377604">eval_jac_g</a>. Calling an optional function that is not provided results in an <a class="el" href="structalpaqa_1_1not__implemented__error.html">alpaqa::not_implemented_error</a> exception being thrown.</p>
<h2><a class="anchor" id="specialized-combined-evaluations"></a>
Specialized combined evaluations</h2>
<p>In practice, the solvers do not always evaluate the functions \( f(x) \) and \( g(x) \) directly. Instead, they evaluate the Lagrangian and augmented Lagrangian functions of the problem. In many applications, such as single-shooting optimal control problems, some computations are common to the evaluation of both \( f(x) \) and \( g(x) \), and significant speedups can be achieved by providing implementations that evaluate both at the same time, or even compute the (augmented) Lagrangian directly. Similarly, when using automatic differentiation, evaluation of the gradient \( \nabla f(x) \) produces the function value \( f(x) \) as a byproduct, motivating the simultaneous evaluation of these quantities as well.</p>
<p>The full list of these combined evaluations can be found in the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">TypeErasedProblem</a> documentation. They can be provided in the same fashion as <code>eval_f</code> above.</p><ul>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#aa68007440e5fa3b8ec89cc391566c91d">eval_f_grad_f</a>: \( f(x) \) and \( \nabla f(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a2959ea61d3e1e537f77b965e22d91ddf">eval_f_g</a>: \( f(x) \) and \( g(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a6f4989c25256ca477442ef34ae1c6b7f">eval_grad_f_grad_g_prod</a>: \( \nabla f(x) \) and \( \nabla g(x)\,y \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a5f0f7f91b5bd3732b02700627e9a8558">eval_grad_L</a>: gradient of the Lagrangian: \( \nabla_{\!x} L(x, y) = \nabla f(x) + \nabla g(x)\,y \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a5003755b3ffefadc3e812fcda2e1a061">eval_ψ</a>: augmented Lagrangian: \( \psi(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#af4e909497793ecd72eb8dcc4f5c2a55c">eval_grad_ψ</a>: gradient of the augmented Lagrangian: \( \nabla \psi(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a0c394deb85f2860c2ecc65a8a7ae4036">eval_ψ_grad_ψ</a>: augmented Lagrangian and gradient: \( \psi(x) \) and \( \nabla \psi(x) \)</li>
</ul>
<h2><a class="anchor" id="proximal-operators"></a>
Proximal operators</h2>
<p>In addition to standard box constraints on the variables, some solvers also allow the addition of a possibly non-smooth, proximal term to the objective.</p>
<p class="formulaDsp">
\[
\begin{equation}\tag{P-prox}\label{eq:problem_prox}
    \begin{aligned}
        &amp; \underset{x}{\text{minimize}}
        &amp; &amp; f(x) + h(x) &amp;&amp;&amp;&amp; f : \Rn \rightarrow \R,\;\; h : \Rn \rightarrow \overline{\R} \\
        &amp; \text{subject to}
        &amp; &amp; \underline{z} \le g(x) \le \overline{z} &amp;&amp;&amp;&amp; g : \Rn \rightarrow \Rm
    \end{aligned}
\end{equation}
\]
</p>
<p> By selecting  </p><p class="formulaDsp">
\[ h(x) = \delta_C(x) \;\defeq\; \begin{cases}
0 &amp; \text{if } x \in C \\ +\infty &amp; \text{otherwise,} \end{cases} \]
</p>
<p> the standard NLP formulation \( \eqref{eq:problem_main} \) is recovered.</p>
<p>To add a custom function \( h(x) \) to the problem formulation, it suffices to implement the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a02bf998629ca590cf5a2e183cbf43444">eval_prox_grad_step</a> function, which computes a forward-backward step \( p = \prox_{\gamma h}\big(x - \gamma \nabla \psi(x)\big) - x \), where the current iterate \( x \), the gradient \( \nabla \psi(x) \) and a positive step size \( \gamma \) are given, and where \( \prox_{\gamma h}(z) \;\defeq\;
\argmin_x \left\{ h(x) + \tfrac{1}{2\gamma} \normsq{x - z} \right\} \) denotes the proximal operator of \( h \) with step size \( \gamma \).</p>
<p>Note that in general, combining an arbitrary function \( h(x) \) with the box constraints \( x \in C \) is not possible. One notable exception is the \( \ell_1 \)-norm \( h(x) = \lambda\norm{x}_1 \). This choice for \( h \), in combination with the box constraints, is supported by the <a class="el" href="classalpaqa_1_1BoxConstrProblem.html">alpaqa::BoxConstrProblem</a> class, by setting the <a class="el" href="classalpaqa_1_1BoxConstrProblem.html#ae1f779407ed5dda49af2f3816301b158">alpaqa::BoxConstrProblem::l1_reg</a> member.</p>
<p>The <a class="el" href="group__grp__Functions.html#ga8310f2110bbe799073e0df9cfc147bcd">alpaqa::prox_step</a> utility function can be used to implement <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a02bf998629ca590cf5a2e183cbf43444">eval_prox_grad_step</a>. See <a class="el" href="group__grp__Functions.html">Functions and operators</a> for details.</p>
<h1><a class="anchor" id="dynamically-loading-problems"></a>
Dynamically loading problems</h1>
<p>alpaqa has a dependency-free, single-header C API that can be used to define problems in a shared library that can be dynamically loaded by the solvers.</p>
<p>The API is defined in <a class="el" href="dl-problem_8h.html">dl-problem.h</a>. The main entry point of your shared object should be a function called <code>register_alpaqa_problem</code> that returns a struct of type <a class="el" href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a>. This struct contains a pointer to the problem instance, a function pointer that will be called to clean up the problem instance, and a pointer to a struct of type <a class="el" href="structalpaqa__problem__functions__t.html">alpaqa_problem_functions_t</a>, which contains function pointers to all problem functions.</p>
<p>Additional user-defined arguments can be passed through a parameter with type <a class="el" href="dl-problem_8h.html#structalpaqa__register__arg__t">alpaqa_register_arg_t</a> of the <code>register_alpaqa_problem</code> function.</p>
<p>In C++, you could register a problem like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dl-problem_8h.html">alpaqa/dl/dl-problem.h</a>&gt;</span></div>
<div class="line"><span class="keyword">using </span>real_t = <a class="code hl_typedef" href="dl-problem_8h.html#a8f665b773252134c3e1c76fca0350ca9">alpaqa_real_t</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Custom problem class to expose to alpaqa.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">struct </span>Problem {</div>
<div class="line">    <a class="code hl_struct" href="structalpaqa__problem__functions__t.html">alpaqa_problem_functions_t</a> funcs{};</div>
<div class="line"> </div>
<div class="line">    real_t eval_f(<span class="keyword">const</span> real_t *x_) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> eval_grad_f(<span class="keyword">const</span> real_t *x_, real_t *gr_) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> eval_g(<span class="keyword">const</span> real_t *x_, real_t *g_) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> eval_grad_g_prod(<span class="keyword">const</span> real_t *x_, <span class="keyword">const</span> real_t *y_, real_t *gr_) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> initialize_box_C(real_t *lb_, real_t *ub_) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> initialize_box_D(real_t *lb_, real_t *ub_) <span class="keyword">const</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Custom function that&#39;s also exposed through @ref alpaqa::dl::DLProblem.</span></div>
<div class="line"><span class="comment"></span>    std::string get_extra_info()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;...&quot;</span>; }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Constructor initializes the problem and exposes the problem functions.</span></div>
<div class="line"><span class="comment"></span>    Problem(<span class="comment">/* ... */</span>) {</div>
<div class="line">        <span class="keyword">using </span><a class="code hl_function" href="namespacealpaqa.html#ac89f5922c0df808ae24f23e0f2561191">alpaqa::member_caller</a>;</div>
<div class="line">        funcs.n                = 3; <span class="comment">// number of variables</span></div>
<div class="line">        funcs.m                = 2; <span class="comment">// number of constraints</span></div>
<div class="line">        funcs.eval_f           = member_caller&lt;&amp;Problem::eval_f&gt;();</div>
<div class="line">        funcs.eval_grad_f      = member_caller&lt;&amp;Problem::eval_grad_f&gt;();</div>
<div class="line">        funcs.eval_g           = member_caller&lt;&amp;Problem::eval_g&gt;();</div>
<div class="line">        funcs.eval_grad_g_prod = member_caller&lt;&amp;Problem::eval_grad_g_prod&gt;();</div>
<div class="line">        funcs.initialize_box_C = member_caller&lt;&amp;Problem::initialize_box_C&gt;();</div>
<div class="line">        funcs.initialize_box_D = member_caller&lt;&amp;Problem::initialize_box_D&gt;();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Main entry point: called by the @ref alpaqa::dl::DLProblem class.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <a class="code hl_struct" href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a></div>
<div class="line">register_alpaqa_problem(<a class="code hl_struct" href="dl-problem_8h.html#structalpaqa__register__arg__t">alpaqa_register_arg_t</a> user_data) <span class="keyword">noexcept</span> <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="keyword">auto</span> problem = std::make_unique&lt;Problem&gt;(<span class="comment">/* ... */</span>);</div>
<div class="line">    <a class="code hl_struct" href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a> result;</div>
<div class="line">    <a class="code hl_function" href="namespacealpaqa.html#aaa3d18067ff2a8792845870baeb6c53a">alpaqa::register_member_function</a>(result, <span class="stringliteral">&quot;get_extra_info&quot;</span>, &amp;Problem::get_extra_info);</div>
<div class="line">    result.<a class="code hl_variable" href="structalpaqa__problem__register__t.html#ae4bc438069960eba10e7d965867c1727">functions</a> = &amp;problem-&gt;funcs;</div>
<div class="line">    result.<a class="code hl_variable" href="structalpaqa__problem__register__t.html#ae1b90392cd257d16fd66a85bac1b08cd">instance</a>  = problem.release();</div>
<div class="line">    result.<a class="code hl_variable" href="structalpaqa__problem__register__t.html#a1eaa491e8cc81620bcf4875d22d22b2b">cleanup</a>   = [](<span class="keywordtype">void</span> *instance) { <span class="keyword">delete</span> <span class="keyword">static_cast&lt;</span>Problem *<span class="keyword">&gt;</span>(instance); };</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">} <span class="keywordflow">catch</span> (...) {</div>
<div class="line">    <span class="keywordflow">return</span> {.<a class="code hl_variable" href="structalpaqa__problem__register__t.html#a5e58a53fd5f925dc254d8be0b70556f3">exception</a> = <span class="keyword">new</span> <a class="code hl_struct" href="dl-problem_8h.html#structalpaqa__exception__ptr__s">alpaqa_exception_ptr_t</a>{std::current_exception()}};</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Used by @ref alpaqa::dl::DLProblem to ensure binary compatibility.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <a class="code hl_typedef" href="dl-problem_8h.html#a697c52450dcef2513deefb49ec71fc05">alpaqa_dl_abi_version_t</a></div>
<div class="line">register_alpaqa_problem_version() { <span class="keywordflow">return</span> <a class="code hl_define" href="dl-problem_8h.html#a0b214d7dfb94b2214ad4b27b293b922d">ALPAQA_DL_ABI_VERSION</a>; }</div>
<div class="ttc" id="adl-problem_8h_html"><div class="ttname"><a href="dl-problem_8h.html">dl-problem.h</a></div></div>
<div class="ttc" id="adl-problem_8h_html_a0b214d7dfb94b2214ad4b27b293b922d"><div class="ttname"><a href="dl-problem_8h.html#a0b214d7dfb94b2214ad4b27b293b922d">ALPAQA_DL_ABI_VERSION</a></div><div class="ttdeci">#define ALPAQA_DL_ABI_VERSION</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00008">dl-problem.h:8</a></div></div>
<div class="ttc" id="adl-problem_8h_html_a697c52450dcef2513deefb49ec71fc05"><div class="ttname"><a href="dl-problem_8h.html#a697c52450dcef2513deefb49ec71fc05">alpaqa_dl_abi_version_t</a></div><div class="ttdeci">uint64_t alpaqa_dl_abi_version_t</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00034">dl-problem.h:34</a></div></div>
<div class="ttc" id="adl-problem_8h_html_a8f665b773252134c3e1c76fca0350ca9"><div class="ttname"><a href="dl-problem_8h.html#a8f665b773252134c3e1c76fca0350ca9">alpaqa_real_t</a></div><div class="ttdeci">double alpaqa_real_t</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00031">dl-problem.h:31</a></div></div>
<div class="ttc" id="adl-problem_8h_html_structalpaqa__exception__ptr__s"><div class="ttname"><a href="dl-problem_8h.html#structalpaqa__exception__ptr__s">alpaqa_exception_ptr_s</a></div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00683">dl-problem.h:683</a></div></div>
<div class="ttc" id="adl-problem_8h_html_structalpaqa__register__arg__t"><div class="ttname"><a href="dl-problem_8h.html#structalpaqa__register__arg__t">alpaqa_register_arg_t</a></div><div class="ttdoc">User-provided argument that is passed to the problem registration functions.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00065">dl-problem.h:65</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_aaa3d18067ff2a8792845870baeb6c53a"><div class="ttname"><a href="namespacealpaqa.html#aaa3d18067ff2a8792845870baeb6c53a">alpaqa::register_member_function</a></div><div class="ttdeci">void register_member_function(Result &amp;result, std::string name, Ret(T::*member)(Args...))</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00734">dl-problem.h:734</a></div></div>
<div class="ttc" id="anamespacealpaqa_html_ac89f5922c0df808ae24f23e0f2561191"><div class="ttname"><a href="namespacealpaqa.html#ac89f5922c0df808ae24f23e0f2561191">alpaqa::member_caller</a></div><div class="ttdeci">static auto member_caller()</div><div class="ttdoc">Wrap the given member function or variable into a (possibly generic) lambda function that accepts the...</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00804">dl-problem.h:804</a></div></div>
<div class="ttc" id="astructalpaqa__problem__functions__t_html"><div class="ttname"><a href="structalpaqa__problem__functions__t.html">alpaqa_problem_functions_t</a></div><div class="ttdoc">C API providing function pointers to problem functions.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00210">dl-problem.h:210</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html"><div class="ttname"><a href="structalpaqa__problem__register__t.html">alpaqa_problem_register_t</a></div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00447">dl-problem.h:447</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_a1eaa491e8cc81620bcf4875d22d22b2b"><div class="ttname"><a href="structalpaqa__problem__register__t.html#a1eaa491e8cc81620bcf4875d22d22b2b">alpaqa_problem_register_t::cleanup</a></div><div class="ttdeci">void(* cleanup)(void *)</div><div class="ttdoc">Pointer to the function to clean up instance.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00456">dl-problem.h:456</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_a5e58a53fd5f925dc254d8be0b70556f3"><div class="ttname"><a href="structalpaqa__problem__register__t.html#a5e58a53fd5f925dc254d8be0b70556f3">alpaqa_problem_register_t::exception</a></div><div class="ttdeci">alpaqa_exception_ptr_t * exception</div><div class="ttdoc">Pointer to an exception that ocurred during problem creation.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00462">dl-problem.h:462</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_ae1b90392cd257d16fd66a85bac1b08cd"><div class="ttname"><a href="structalpaqa__problem__register__t.html#ae1b90392cd257d16fd66a85bac1b08cd">alpaqa_problem_register_t::instance</a></div><div class="ttdeci">void * instance</div><div class="ttdoc">Owning pointer.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00452">dl-problem.h:452</a></div></div>
<div class="ttc" id="astructalpaqa__problem__register__t_html_ae4bc438069960eba10e7d965867c1727"><div class="ttname"><a href="structalpaqa__problem__register__t.html#ae4bc438069960eba10e7d965867c1727">alpaqa_problem_register_t::functions</a></div><div class="ttdeci">alpaqa_problem_functions_t * functions</div><div class="ttdoc">Non-owning pointer, lifetime at least as long as instance.</div><div class="ttdef"><b>Definition</b> <a href="dl-problem_8h_source.html#l00454">dl-problem.h:454</a></div></div>
</div><!-- fragment --><p>A full example can be found in <a class="el" href="problems_2sparse-logistic-regression_8cpp-example.html">problems/sparse-logistic-regression.cpp</a>. While defining the <code>register_alpaqa_problem</code> in C++ is usually much more ergonomic than in plain C, the latter is also supported, as demonstrated in <a class="el" href="C_09_09_2DLProblem_2main_8cpp-example.html">C++/DLProblem/main.cpp</a>.</p>
<p>The problem can then be loaded using the <a class="el" href="classalpaqa_1_1dl_1_1DLProblem.html">alpaqa::dl::DLProblem</a> class, or using the <code>alpaqa-driver</code> command line interface. For more details, see the two examples mentioned previously.</p>
<h1><a class="anchor" id="existing-problem-adapters"></a>
Existing problem adapters</h1>
<p>For interoperability with existing frameworks like <a href="https://web.casadi.org/">CasADi</a> and <a href="https://github.com/ralna/CUTEst">CUTEst</a>, alpaqa provides the following problem adapters:</p>
<ul>
<li><a class="el" href="classalpaqa_1_1CasADiProblem.html">alpaqa::CasADiProblem</a></li>
<li><a class="el" href="classalpaqa_1_1CUTEstProblem.html">alpaqa::CUTEstProblem</a></li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__grp__Problems.html">Problems</a> topic </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2024 for alpaqa by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
