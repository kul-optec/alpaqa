<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>alpaqa: Problem formulations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {    Reals: "{\\mathrm{I\\!R}}",
    Nats: "{\\mathrm{I\\!N}}",
    Cplx: "{\\mathbb{C}}",
    R: "{\\Reals}",
    N: "{\\Nats}",
    C: "{\\Cplx}",
    Rn: "{\\Reals^n}",
    Rm: "{\\Reals^m}",
    gph: "{\\operatorname{\\mathbf{gph}}}",
    zer: "{\\operatorname{\\mathbf{zer}}}",
    fix: "{\\operatorname{\\mathbf{fix}}}",
    minimize: "{\\operatorname*{\\mathbf{minimize}}}",
    st: "{\\operatorname*{\\mathbf{s.\\!t.}}}",
    argmin: "{\\operatorname*{\\mathbf{arg\\,min}}}",
    argmax: "{\\operatorname*{\\mathbf{arg\\,max}}}",
    subjto: "{\\operatorname*{\\mathbf{subject\\;to}}}",
    prox: "{\\operatorname{\\mathbf{prox}}}",
    Hilb: "{\\mathcal{H}}",
    proj: ["{\\operatorname{\\mathbf{\\Pi}_\\mathnormal{#1}}}",1],
    dist: "{\\operatorname{\\mathbf{dist}}}",
    Id: "{\\mathrm{Id}}",
    I: "{\\mathrm{I}}",
    one: "{\\mathbf{1}}",
    defeq: "{\\triangleq}",
    inprod: ["{\\left\\langle {#1} \\,\\middle|\\, {#2} \\right\\rangle}",2],
    norm: ["{\\left\\| {#1} \\vphantom{X} \\right\\|}",1],
    normsq: ["{\\norm{#1}^2}",1],
    defset: ["{\\left\\{ {#1} \\;\\middle|\\; {#2} \\right\\}}",2],
    tp: ["{#1^\\top}",1],
    ttp: ["{#1^{\\!\\top\\!}}",1],
    herm: ["{#1^\\mathrm{H}}",1],
    invherm: ["{#1^{-\\mathrm{H}}}",1],
    inv: ["{#1^{-1}}",1],
    pinv: ["{#1^\\dagger}",1],
    lconj: "{\\overline}",
    sconj: ["{#1^*}",1],
    iddots: "{\\mathinner{\\kern1mu\\raise1pt{.}\\kern2mu\\raise4pt{.}\\kern2mu\\raise7pt{\\Rule{0pt}{7pt}{0pt}.}\\kern1mu}}",
    imagfun: ["{\\left(#1\\right)\\left(#2\\right)}",2],
    Lagr: "{\\mathcal{L}}",
    jac: "{\\mathrm{J}}",
    dft: "{\\operatorname{\\mathbf{dft}}}",
    cbrt: ["{\\sqrt[3]{#1}}",1],
    sgn: "{\\operatorname{\\mathbf{sgn}}}",
    setmap: "{\\rightrightarrows}",
    lammin: "{\\lambda_\\text{min}}",
    lammax: "{\\lambda_\\text{max}}",
    Sc: "{\\mathcal{S}}",
    Scstar: "{\\mathcal{S}^*}",
    diag: "{\\operatorname{\\mathbf{diag}}}",
    blkdiag: "{\\operatorname{\\mathbf{blkdiag}}}",
    posdef: "{\\succ}",
    possdef: "{\\succeq}",
    half: "{\\tfrac{1}{2}}",
    hhbar: "{\\hbar}",
    barxuk: "{\\bar x^k\\!, \\bar u^k}",
    },
    packages: ['base','configmacros','newcommand','ams']
  }
};
window.MathJax.tex.tags = 'ams';
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">alpaqa<span id="projectnumber">&#160;<code><a href="/alpaqa/index.html">1.0.0a8</a></code></span>
   </div>
   <div id="projectbrief">Nonconvex constrained optimization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Problem formulations </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#problem_formulations_general">General NLP formulation</a></li>
<li class="level1"><a href="#autotoc_md30">Problem API</a><ul><li class="level2"><a href="#autotoc_md31">Base classes for common use cases</a></li>
<li class="level2"><a href="#autotoc_md32">Second-order derivatives</a></li>
<li class="level2"><a href="#autotoc_md33">Specialized combined evaluations</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md____w_alpaqa_alpaqa_doxygen_pages_Problem_formulations"></a></p>
<h1><a class="anchor" id="problem_formulations_general"></a>
General NLP formulation</h1>
<p>Most alpaqa solvers deal with problems in the following form:</p>
<p class="formulaDsp">
\[
\begin{equation}\tag{P}\label{eq:problem_main}
    \begin{aligned}
        &amp; \underset{x}{\text{minimize}}
        &amp; &amp; f(x) &amp;&amp;&amp;&amp; f : \Rn \rightarrow \R \\
        &amp; \text{subject to}
        &amp; &amp; \underline{x} \le x \le \overline{x} \\
        &amp;&amp;&amp; \underline{z} \le g(x) \le \overline{z} &amp;&amp;&amp;&amp; g : \Rn \rightarrow \Rm
    \end{aligned}
\end{equation}
\]
</p>
<p>\( f \) is called the cost or objective function, and \( g \) is the constraints function.</p>
<p>The solver needs to be able to evaluate the following required functions and derivatives:</p><ul>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ac9fcb632c5d0395e2c36e39277efd1b0">eval_f</a> \( : \Rn \to \R : x \mapsto f(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#aba98edc04bad2e0a3ad6645991cd7535">eval_grad_f</a> \( : \Rn \to \Rn : x \mapsto \nabla f(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#acdf5c7c7f249c05d53643e1715070f45">eval_g</a> \( : \Rn \to \Rm : x \mapsto g(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ab3ddf22ddba40c16ab196c1371405ea0">eval_grad_g_prod</a> \( : \Rn \times \Rm \to \Rn : (x, y) \mapsto \nabla g(x)\, y \)</li>
</ul>
<p>Usually, <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">automatic differentiation</a> (AD) is used to evaluate the gradients and gradient-vector products. Many AD software packages are available, see e.g. <a href="https://autodiff.org/">https://autodiff.org/</a> for an overview.</p>
<p>Additionally, the solver needs to be able to project onto the rectangular sets  </p><p class="formulaDsp">
\[
\begin{equation}
    \begin{aligned}
        C &amp;\;\defeq\; \defset{x \in \Rn}{\underline{x} \le x \le \overline{x}}, \\
        D &amp;\;\defeq\; \defset{z \in \Rm}{\underline{z} \le z \le \overline{z}}.
    \end{aligned}
\end{equation}
\]
</p>
<h1><a class="anchor" id="autotoc_md30"></a>
Problem API</h1>
<p>The alpaqa solvers access the problem functions through the API outlined in <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">alpaqa::TypeErasedProblem</a>. <br  />
 Usually, problems are defined using C++ structs, providing the evaluations described above as public member functions. These problem structs are <a href="https://en.wikipedia.org/wiki/Structural_type_system">structurally typed</a>, which means that they only need to provide member functions with the correct names and signatures. Inheriting from a common base class is not required.</p>
<p>As an example, the following struct defines a problem that can be passed to the alpaqa solvers. Detailed descriptions of each function can be found in the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">alpaqa::TypeErasedProblem</a> documentation.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>RosenbrockProblem {</div>
<div class="line">    <a class="code hl_define" href="config_8hpp.html#a3c06cc0dbec2055c76ab3d5fcc91736c">USING_ALPAQA_CONFIG</a>(<a class="code hl_struct" href="structalpaqa_1_1DefaultConfig.html">alpaqa::DefaultConfig</a>);</div>
<div class="line">    <span class="comment">// Problem dimensions</span></div>
<div class="line">    length_t get_n() <span class="keyword">const</span>; <span class="comment">// number of unknowns</span></div>
<div class="line">    length_t get_m() <span class="keyword">const</span>; <span class="comment">// number of general constraints</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cost</span></div>
<div class="line">    real_t eval_f(crvec x) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Gradient of cost</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_grad_f(crvec x, rvec grad_fx) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Constraints</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_g(crvec x, rvec gx) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Gradient-vector product of constraints</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_grad_g_prod(crvec x, crvec y, rvec grad_gxy) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Proximal gradient step</span></div>
<div class="line">    real_t eval_prox_grad_step(real_t γ, crvec x, crvec grad, rvec x̂, rvec p) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Projecting difference onto constraint set D</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_proj_diff_g(crvec z, rvec p) <span class="keyword">const</span>;</div>
<div class="line">    <span class="comment">// Projection of Lagrange multipliers</span></div>
<div class="line">    <span class="keywordtype">void</span> eval_proj_multipliers(rvec y, real_t max_y) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="ttc" id="aconfig_8hpp_html_a3c06cc0dbec2055c76ab3d5fcc91736c"><div class="ttname"><a href="config_8hpp.html#a3c06cc0dbec2055c76ab3d5fcc91736c">USING_ALPAQA_CONFIG</a></div><div class="ttdeci">#define USING_ALPAQA_CONFIG(Conf)</div><div class="ttdef"><b>Definition:</b> <a href="config_8hpp_source.html#l00042">config.hpp:42</a></div></div>
<div class="ttc" id="astructalpaqa_1_1DefaultConfig_html"><div class="ttname"><a href="structalpaqa_1_1DefaultConfig.html">alpaqa::DefaultConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="config_8hpp_source.html#l00132">config.hpp:132</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Base classes for common use cases</h2>
<p>Convenience classes with default implementations of some of these functions are provided for common use cases:</p><ul>
<li><a class="el" href="classalpaqa_1_1BoxConstrProblem.html">BoxConstrProblem</a> defines the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ae9f75b521c8932199f92bfdfc8f91879">eval_proj_diff_g</a>, <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ab84164ea48e4cdae5396285423fed829">eval_proj_multipliers</a> and <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a02bf998629ca590cf5a2e183cbf43444">eval_prox_grad_step</a> functions for the specific case where \( C \) and \( D \) are rectangular boxes, as in \( \eqref{eq:problem_main} \).</li>
<li><a class="el" href="classalpaqa_1_1UnconstrProblem.html">UnconstrProblem</a> defines those same functions, and additional empty implementations of constraint-related functions to allow a more concise formulation of unconstrained problems.</li>
</ul>
<p>The user can simply inherit from these classes to inject the default implementations into their problem definition, as demonstrated in the following examples.</p><ul>
<li><a class="el" href="C_09_09_2CustomCppProblem_2main_8cpp-example.html">C++/CustomCppProblem/main.cpp</a></li>
<li><a class="el" href="C_09_09_2SimpleUnconstrProblem_2main_8cpp-example.html">C++/SimpleUnconstrProblem/main.cpp</a></li>
</ul>
<p>It is highly recommended to study the <a class="el" href="C_09_09_2CustomCppProblem_2main_8cpp-example.html">C++/CustomCppProblem/main.cpp</a> example now to see how optimization problems can be formulated in practice, before we continue with some more specialized use cases.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Second-order derivatives</h2>
<p>Some solvers can exploit information about the Hessian of the (augmented) Lagrangian of the problem. To use these solvers, some of the following functions are required, they should be added as member functions to your problem struct.</p><ul>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#af081bd553ada01e6498e26c4210f267f">eval_jac_g</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ad41b8495a9eea0e1c313d749c5a98b69">get_jac_g_num_nonzeros</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a1a3532b9cb69303527a65d24e07b23b8">eval_grad_gi</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#ab5bca0389ad783efa413bbdda072b9e9">eval_hess_L_prod</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a8432c33fb118d707216d6098734c4160">eval_hess_L</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#aff13d511093c03b6d1f00de23ce8fae5">get_hess_L_num_nonzeros</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#afbb23530a41d88544aa22358de5d7d1f">eval_hess_ψ_prod</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a1c6397671d61e7194556ea6c691764d0">eval_hess_ψ</a></li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#afdb9f9fd484c7b8d1b88649c2f9fbd72">get_hess_ψ_num_nonzeros</a></li>
</ul>
<p>Sparse matrices are stored in <a href="https://www.eigen.tuxfamily.org/dox/group__TutorialSparse.html#TutorialSparseIntro">compressed column storage</a> (CCS) format. For symmetric Hessian matrices, only the upper triangle is stored. Upon initialization, the number of nonzeros is queried by the solver using the <code>get_xyz_num_nonzeros()</code> function, and storage is allocated for the arrays of column/row indices and for the nonzero values. Then the <code>eval_xyz()</code> function is called once with an empty <code>values</code> argument (<code>values.size() == 0</code>), indicating that the column/row indices representing the sparsity should be initialized. Subsequent calls to <code>eval_xyz()</code> then pass a non-empty <code>values</code> argument, in addition to the initialized column/row indices, and the user should then overwrite the nonzero values of the matrix.</p>
<p>If the matrix is dense, <code>get_xyz_num_nonzeros()</code> should return <code>-1</code>, the column/row indices are not used, and the <code>values</code> argument to <code>eval_xyz()</code> provides storage for a dense column-major matrix.</p>
<dl class="section note"><dt>Note</dt><dd>Currently, symmetric dense matrices should store the full matrix, not just the upper triangular part. This is different from the sparse case, and we might want to change this in the future.</dd></dl>
<p>Some solvers do not require the full Hessian matrices, but use Hessian-vector products only, for example when using Newton-CG. These products can often be computed efficiently using automatic differentiation, at a computational cost that's not much higher than a gradient evaluation.</p>
<p>The <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">TypeErasedProblem</a> class provides functions to query which optional problem functions are available. For example, <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a3abcd94b37675bbd5f6a86e3fb85cda1">provides_eval_jac_g</a> returns true if the problem provides an implementation for <a class="el" href="classalpaqa_1_1TypeErasedProblem.html#af081bd553ada01e6498e26c4210f267f">eval_jac_g</a>. Calling an optional function that is not provided results in an <a class="el" href="structalpaqa_1_1not__implemented__error.html">alpaqa::not_implemented_error</a> exception being thrown.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Specialized combined evaluations</h2>
<p>In practice, the solvers do not always evaluate the functions \( f(x) \) and \( g(x) \) directly. Instead, they evaluate the Lagrangian and augmented Lagrangian functions of the problem. In many applications, such as single-shooting optimal control problems, some computations are common to the evaluation of both \( f(x) \) and \( g(x) \), and significant speedups can be achieved by providing implementations that evaluate both at the same time, or even compute the (augmented) Lagrangian directly. Similarly, when using automatic differentiation, evaluation of the gradient \( \nabla f(x) \) produces the function value \( f(x) \) as a byproduct, motivating the simultaneous evaluation of these quantities as well.</p>
<p>The full list of these combined evaluations can be found in the <a class="el" href="classalpaqa_1_1TypeErasedProblem.html">TypeErasedProblem</a> documentation. They can be provided in the same fashion as <code>eval_f</code> above.</p><ul>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#aa68007440e5fa3b8ec89cc391566c91d">eval_f_grad_f</a>: \( f(x) \) and \( \nabla f(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a2959ea61d3e1e537f77b965e22d91ddf">eval_f_g</a>: \( f(x) \) and \( g(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a6f4989c25256ca477442ef34ae1c6b7f">eval_grad_f_grad_g_prod</a>: \( \nabla f(x) \) and \( \nabla g(x)\,y \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a5f0f7f91b5bd3732b02700627e9a8558">eval_grad_L</a>: gradient of Lagrangian: \( \nabla_x L(x, y) = \nabla f(x) + \nabla g(x)\,y \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a5003755b3ffefadc3e812fcda2e1a061">eval_ψ</a>: augmented Lagrangian: \( \psi(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#af4e909497793ecd72eb8dcc4f5c2a55c">eval_grad_ψ</a>: gradient of augmented Lagrangian: \( \nabla \psi(x) \)</li>
<li><a class="el" href="classalpaqa_1_1TypeErasedProblem.html#a0c394deb85f2860c2ecc65a8a7ae4036">eval_ψ_grad_ψ</a>: augmented Lagrangian and gradient: \( \psi(x) \) and \( \nabla \psi(x) \) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
